<div class="container">
  <div class="row">
    <div class="col-md-6">
      <p>
        <strong>Customer:</strong>
        <%= link_to @work_order.customer.name, @work_order.customer if @work_order.customer %>
      </p>

      <p>
        <strong>Contact:</strong>
        <% if @work_order.contact %>
          <%= link_to @work_order.contact.full_name, @work_order.contact %>
        <% elsif @work_order.customer.try :primary_contact %>
          <%= link_to @work_order.customer.primary_contact.full_name, @work_order.customer.primary_contact %>
        <% else %>
          'Please add a primary contact to this customer or add a contact to this work order.'
        <% end %>
      </p>

      <p>
        <strong>Date scheduled:</strong>
        <%= @work_order.date_scheduled.strftime('%b %e, %l:%M %p') if @work_order.date_scheduled %>
      </p>

      <p>
        <strong>Date due:</strong>
        <%= due_date_formatter(@work_order.date_due, @work_order.date_completed) %>
      </p>

      <p>
        <strong>Packaging details:</strong>
        <%= @work_order.packaging_details.present? ? @work_order.packaging_details : 'No details specified.' %>
      </p>

      <p>
        <strong>Date completed:</strong>
        <%= @work_order.date_completed ? @work_order.date_completed.strftime('%b %e, %l:%M %p') : 'Not yet completed.' %>
        <%= ", by: #{@work_order.completed_by.try :full_name}" if @work_order.completed_by %>
      </p>
    </div>
    <div class="col-md-6">
      <% unless @work_order.date_completed %>
        <%= simple_form_for @work_order, url: mark_completed_work_order_path, method: :put do |f| %>
          <div class="row">
            <div class="col">
              <%= f.input :date_completed, label: false, as: :date_time_picker %>
              <%= f.input :marked_completed_by, as: :hidden, input_html: { value: current_user.id } %>
            </div>
            <div class="col">
              <%= f.submit 'Mark Completed', data: { confirm: 'Are you sure you want to mark this completed?' },
                                             class: 'btn btn-success' %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <h2 class="mt-4 mb-4">Services</h2>
      <% @work_order.services.each do |service| %>
        <span class="mr-2"><i class="icon icon-check text-success"></i> <%= service.name %> </span>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <h2 class="mt-4 mb-4">Parts</h2>
      <table class='table'>
        <thead>
          <tr>
            <th></th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <% @work_order.line_items.each_with_index do |line_item, i| %>
          <tr>
            <td><%= i + 1 %></td>
            <td><%= line_item.description %></td>
            <td><%= line_item.quantity %></td>
            <td><%= line_item.notes %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <p>
        <%= link_to 'Edit', edit_work_order_path(@work_order) %> |
        <%= link_to 'Back', work_orders_path %>
      </p>
    </div>
  </div>
</div>
